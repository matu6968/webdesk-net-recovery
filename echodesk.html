<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="./assets/style.css" />
    <link rel="shortcut icon" href="./assets/img/favicon.png">
    <link rel="apple-touch-icon" href="./assets/img/noround.png">
    <title>WebDesk Miminal Recovery (static librhlcaaries) </title>
</head>
<script>
    let url = window.location.href;
    let params = new URLSearchParams(window.location.search);

    var abt = {
        lastmod: "Jan 9, 2025",
        ver: "0.2.9",
    }

    var sys = {
        deskid: undefined,
        setupd: undefined,
        migrid: 1,
        autodarkacc: undefined,
        webdrop: true,
        name: "Default User",
        model: undefined,
        nvol: 1.0,
        installer: undefined,
        peer: undefined,
        currentf: undefined,
        full: false,
        guest: false,
        echoid: undefined,
        fucker: false,
        clip: undefined,
        dev: false,
        mob: false,
        mobui: false,
        city: "Paris, France",
        unit: "Metric",
        defaultloc: true,
        unitsym: "Â°C",
        seconds: false,
        echodesk: true,
        appurl: `https://appmarket.meower.xyz/refresh`,
        filter: false,
        nc: false,
        loclast: Date.now(),
        notifsrc: "/assets/other/notif1.ogg",
        lowgfx: false,
        lockscreen: true,
        contained: false
    }
    var el = {
        taskbar: undefined,
        migstat: undefined,
        webchat: undefined,
        currentid: undefined,
        lock: undefined,
        sm: undefined,
        tr: undefined,
        cc: undefined,
        dropped: false,
        deskicon: undefined,
    }

    var wc = {
        webchat: undefined,
        currentid: undefined,
    }
</script>

<body>
    <div id="contain">
        <div class="dark background"></div>
        <div id="background" class="background"></div>
        <div class="circle"></div>
        <div class="circle2"></div>
    </div>
    <div id="setuparea">
    </div>
    <div id="notif"></div>
    </div>
</body>

</html>
<script src="./assets/lib/jq.js"></script>
<script src="./assets/lib/jszip.js"></script>
<script src="./assets/code/core.js"></script>
<script src="./assets/code/wm.js"></script>
<script src="./assets/code/ui.js"></script>
<script src="./assets/code/fs.js"></script>
<script>
    wd.fontsw('./assets/fonts/Poppins-Regular.ttf', './assets/fonts/Poppins-Medium.ttf', './assets/fonts/Poppins-Bold.ttf', './assets/fonts/mono.ttf');
    async function boot() {
        let boot_ui = false;
        ui_init();
        setTimeout(function () {
            if (boot_ui == true) {
                ui.hide(tk.g('death'), 140);
                wm.wal(`<p class="bold">WebDesk Recovery failed to boot</p><p>Click "Try Again" if you want.`, () => reboot(), 'Try Again', 'noclose');
            }                                                                  
        }, 10000);
                                                                             
        const dropZone = document.body;
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        dropZone.addEventListener('drop', handleDrop, false);

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function handleDrop(e) {
            wm.wal(`<p>WebDesk Minimal Recovery mode does not support drag and drop.</p>`);
        }
    }

    function reboot() {
        wd.reboot();
    }
                                                                             
   function ui_init() {
        wd.perfmon();
        ui.crtheme('#010101', true);
        wd.dark('nosave');
        ui.hide(tk.g('death'), 200);
        const main = tk.c('div', tk.g('setuparea'), 'setupbox');
        // HAHAHAHAHA FUNNY NUMBER!!!!
        main.style.height = "425px";
        // create setup menubar
        const bar = tk.c('div', main, 'setupbar');
        const tnav = tk.c('div', bar, 'tnav');
        const title = tk.c('div', bar, 'title');
        tk.cb('b4', 'Force Exit', () => wm.wal(`<p>If WebDesk Recovery is stuck, use this to leave.</p><p>Note: If you have lots of files or a slow connection, it's normal for things to take a while.</p>`, () => reboot(), 'Force Exit'), tnav);
        tk.cb('b4 time', 'what', undefined, title);
        // first menu
        const first = tk.c('div', main, 'setb');
        tk.img('./assets/img/setup/first.svg', 'setupi', first);
        tk.p('WebDesk Minimal Recovery', 'h2', first);
        tk.p(`WebDesk couldn't boot within 10 seconds, so we threw you here. Here's your options:`, undefined, first);
        tk.cb('b1 b2', 'Delete Apps (Usually the main issue, your data will remain)', function () {
            fs.del('/system/apps.json');
            fs.delfold('/system/apps');
            wm.notif(`Deleted apps`, 'All apps were deleted, their data is safe.', undefined, undefined, true);
        }, first);
        tk.cb('b1 b2', 'Reinstall WebDesk (Another issue if the problem is OS related, your data will remain)', function () {
            fs.del('/system/webdesk');
            wd.reboot();
        }, first);
        tk.cb('b1', 'Exit Recovery', () => wd.reboot(), first);
        boot_ui = true;                                                                   
        wm.notif('Recovery', `Your OS being corrupted due to bad decisions probably led you here.`);                                                                  
        //ui.hide(tk.g('death'), 140);
        wm.notif(`Recovery without external resources (static file)`, `Better than dynamic dependency loading but is bigger in file size?`);                                                                       
  }                                                                    

</script>
